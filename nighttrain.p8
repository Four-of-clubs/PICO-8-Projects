pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function _init()
 music(0)
 showtrain = true
 --uses the lower left corner
 tree_array = {-- x,y,w,h
 {16,32,37-16,31-8},
 {38,32,58-38,31-1},
 {59,32,83-59,31-11},
 {84,32,104-84,31-6},
 {105,32,126-105,31-7}
 }
 
 disp_trees = {x,y,id}
 
 pend = {} --x, y, length??
 
 
 snow = {} --x,y,timeoffset
 
 speed = 0
 acc = 0
 
 frame = 0
 framecap = 60

 function put_tree(x,y,id)
 add(disp_trees,{
  x = flr(x), --x == jitter
  y = y,
  id = id --flr(rnd(#tree_array))+1
 })
 end
 
 --returns length of made row
 function make_row(y,space)
  local tempx = -50
  while (tempx <=200) do
   local tempid = flr(rnd(#tree_array))+1
    put_tree(tempx,y,tempid)
    tempx += tree_array[tempid][3] + rnd(1)+space
  end
  return tempx
 end
 
 row1h = 70
 row2h = 56
 row3h = 48
 
 length3 = make_row(row3h,13) 
 length2 = make_row(row2h,10)
 length1 = make_row(row1h,5)
 
 --takes base speed, length of row, and scalar for paralax
 function update_tree(speed,length,scalar, y)
  for i in all(disp_trees) do
   if i.y == y then
    i.x += speed*scalar
    if i.x > length then
     i.x -= (length +50)
    elseif i.x < -50 then
     i.x += length + 50
    end
   end
  end
 end
 
 function draw_tree()
  for i in all(disp_trees) do
   local spinfo = {}
   spinfo = tree_array[i.id]
   local spx = spinfo[1]
   local spy = spinfo[2]-spinfo[4]
   local spw = spinfo[3]
   local sph = spinfo[4]
   sspr(spx,spy,spw,sph,i.x,i.y-sph)
   
  end
 end
 
 function make_snow(x)
  for i=1,x do
   add(snow,{
   x = rnd(124),
   y = rnd(124),
   r = rnd(1)
   })
  end
 end
 make_snow(300)
 
 function update_snow(speed)
  for s in all(snow) do
   s.y += (sin(time()+s.r) + 1)/2
   s.x += (cos(time()+s.r) + 2)/2 + speed
 
   s.y = s.y %60
   s.x = s.x %124
  end
 end
 
 function draw_snow()
  for s in all(snow) do
   pset(s.x, s.y + 30, 7)
  end
 end
end

function _update60()
 
 if btn(1) then
  speed -= .001
 elseif btn(2) then
  speed = 0
 elseif btn(0) then 
  speed += .001
 elseif btnp(3) then
  if showtrain then
   showtrain = false
  else 
   showtrain = true
  end
 end
 if btnp(1) and btn(0) then
  music(-1)
 end
 
 update_snow(speed)
 
 update_tree(speed,length1,1,row1h)
 update_tree(speed,length2,.8,row2h)
 update_tree(speed,length3,.7,row3h)
end

function _draw()
 cls(1)
 
 draw_tree()
 draw_snow()
 --
 if showtrain then
 --ceiling ((((((((
  rectfill(0,0,128,10,5)
  --)))))))
 --floor ((((((((
 rectfill(0,96,128,128,5)
 
 for i=1,16 do
  line(5+i+4,128,10+i+4,96,1)
 end
  line(22+4,128,26+3,96,1)
  
 for i=16,1,-1 do
  line(122-i-5,128,118-i-5,96,1)
 end
  line(128-22-5,128,118-16-5,96,1)
  --))))))))
  
  --wall/window (((((((
  --main
  sspr(8,0,13,10,37,30,13,10,false,false)
  sspr(8,0,13,10,128-37-13,30,13,10,true,false)
  sspr(8,0,13,10,37,56,13,10,false,true)
  sspr(8,0,13,10,128-37-13,56,13,10,true,true)
  line(37+13,30,128-37-13,30,5)
  line(37+13,65,128-37-13,65,5)
  --right
  sspr(8,0,13,10,128-12,30,13,10,false,false)
  sspr(8,0,13,10,128-12,56,13,10,false,true)
  --left
  sspr(8,0,13,10,12-13,30,13,10,true,false)
  sspr(8,0,13,10,12-13,56,13,10,true,true)
  
  --vert blocks
  rectfill(12,11,36,95,6)
  rectfill(128-13,11,128-37,95,6)
  --hor blocks
  rectfill(0,56+10,128,95,6)
  rectfill(0,11,128,29,6)
  --)))))))))))
  
  --chairs ((((((((
  --left main
  rectfill(20,6,23,104,13)
  rectfill(21,105,22,105,13)
  rectfill(21,5,22,5,13)
  
  rectfill(42,90,44,101)
  rectfill(38,95,40,108)
  
  --ll 
  rectfill(3,95,5,108)
  rectfill(0,90,1,101)
  
  --right main
  rectfill(128-20-1,6,128-23-1,104,13)
  rectfill(128-21-1,105,128-22-1,105,13)
  rectfill(128-22,5,128-23,5,13)
  
  rectfill(128-42-2,90,128-44-2,101)
  rectfill(128-38-2,95,128-40-2,108)
  --rr
  rectfill(129-3-2,95,129-5-2,108)
  rectfill(129-2,90,129-1-2,101)
  
  pal(6,2)
  sspr(0,11,15,19,23,52,15*2.5,19*2.5)
  sspr(0,11,15,19,128-23-15*2.5+1,52,15*2.5,19*2.5, true)
  sspr(0,11,15,19,-17,52,15*2.5,19*2.5,true,false) 
  sspr(0,11,15,19,128+17-15*2.5+1,52,15*2.5,19*2.5, false)
  pal()
  --)))))))))))
  end
  
end
__gfx__
00000000666666555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700665000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000665000000000000000000000000000000000777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000650000000000000000000000000000000000733366000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700650000000000000000000000000000000000733333700000000000000000000000000000000000000000000000000000000000000000000000000000
00000000650000000000000000000000000000000000663333300000000000000000000000000000000000000000000000000000000000000000000000000000
00000000500000000000000000000000000000000007333376700000000000000000000000000000000000000000000000000000000000000000000000000000
00000000500000000000000000000000000000000077733333300000000000000000000000000000000000000000066777000000000000000000000000000000
00000000500000000000000777770000000000000766673377670000000000000000000000000000000000000000733333700000000000000677600000000000
00000000000000000000776737337770000000000733367333670000000000000000000000000000000000000007373333370000000066776333770000000000
00000660000000000000766336663377000000000333766777337000000000000000000000000000000000000073376677330000000763333337636600000000
00006116000000000000366333767337000000007333333333337000000000000077770000000000000000000737733673377000000033366637337700000000
06666116000000000000033773736673670000003377777337667700000000000773366777770000000000000733633333337000000007773773333700000000
611161d6000000000000076673333333360000007766333333333300000000077333333333377660000000000333663333336700000000333373336666770000
61116dd1600000000000066333333333300000003333333777333300000000737633776633333377000000007337337777663700000000037733766333330000
61dd6111600000000000333333337773330000003337733336773370000007733666733337673333700000077673333666333300000000003773333333300000
6dd16111166000000000776667337767773000000776337733333670000003377333333767333333300000736633773333333300000000003337373777000000
66111611111600000000333377667336667000000333776633776660000003663333333333773377700006333336667377377660000000777336673333000000
061116111dd100000003377633333333333000000773336773333333000076633366733776633773300006777333336733773367000066766733336667000000
06111661ddd100000003336773337663337000000366333333737773000033333773673333377777730073377767366737333333000776333333376333000000
06111661111000000007773333333377766000000373337336733777000033377333367337766733330033336633377667733333077733337767333377600000
06111166666000000076633366733333376600000333763367333333300336667773333337663333333033333333377333666767033333773366733333660000
06111111116000000033333363337776773300003773373376667773330776333333376633373366773077777333773333336737033777733733336773337000
066111dddd1000000067773337777737767300037633355537337766770333337733377633776673377033673377377333333333003333333376673333336700
006111dddd1000000773377673663337333730033333354533376633330633773773333773333333333036633766667737777330000376667763333766633300
00611dddd11000000333333333553367333770337673554533333377330737633337733337773333333077333363333333667700000033337773333333773700
00661dddd10000003776673775557663333330333373544533737666700336333377333337367333333003777333557733333000000037633733350000336600
00061111110000003333333755443333337730376000544553663333300076333773345555336673333003737335553763330000000337355377350000006000
00066666610000003677300055455003773000000000555553367000000033337377555555337663300000376675445667000000000377545544450000000000
00000000000000000000000045555000000000000000554440000000000033766333555445003333000000000004455000000000006673554445500000000000
00000000000000000000000055544000000000000000555550000000000007666000554455000000000000000005544000000000007000055555000000000000
__sfx__
01100000001230f00000123000000c000180000410000123001230010000123000000012300000000000000000100000000012300000000000000000000001230012300000001230000000000000000000000000
01100000105100e500105200f520105201150013520135001852018500135000d50013520105000000000000135201452015520125001c52000000155200f500135201452015520000001c520000001552000000
011000001352014520155200000018520185000000018520135201452015520000001852013500155200000013520145201552000000185201850000000185201352014520155200000018520135001552000000
0110000018520175201852000000155201550010520000001852017520185200000015520000000000000000105201152013520145201552017520185201a5201c5201c5211c5211c5211c520000000000000000
01100000000000000004010040210402105020070200000000000000000401004021040210502007020000000702008020090200a0200c0200d00000000000000702008020090200a0200c020000000000000000
911000000921000200092100020009212092120921209212002000020009210002000921000200092100020009210002000921000200092120921209212092120020000200092100020009210002000921000200
__music__
01 00010445
01 00020544
01 00030544
01 00020405
02 00030405

